{% extends 'core/base.html' %}
{% block content %}
<div class="card p-4 shadow-sm mb-4">
    <h2 class="mb-3"><i class="bi bi-cash-coin"></i> Cuentas Corrientes</h2>
    <form method="get" class="row g-3 align-items-center mb-3">
        <div class="col-auto">
            <label for="alumno" class="col-form-label">Filtrar por alumno:</label>
        </div>
        <div class="col-auto">
            <select name="alumno" id="alumno" class="form-select">
                <option value="">Todos</option>
                {% for a in alumnos %}
                    <option value="{{ a.id }}" {% if a.id|stringformat:'s' == alumno_id %}selected{% endif %}>{{ a.nombre }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-primary">Filtrar</button>
        </div>
    </form>
    <div class="mb-3 text-end">
        <a href="/cuentas_corrientes/exportar_excel/?{% if alumno_id %}alumno={{ alumno_id }}{% endif %}" class="btn btn-outline-success">
            <i class="bi bi-file-earmark-excel"></i> Exportar a Excel
        </a>
    </div>
    <table class="table table-striped table-bordered align-middle">
        <thead class="table-primary">
            <tr>
                <th>Alumno</th>
                <th>Total Consumos</th>
                <th>Total Pagos</th>
                <th>Saldo</th>
            </tr>
        </thead>
        <tbody>
            {% for cuenta in cuentas %}
            <tr>
                <td>{{ cuenta.alumno.nombre }}</td>
                <td>${{ cuenta.total_consumido }}</td>
                <td>${{ cuenta.total_pagado }}</td>
                <td class="fw-bold {% if cuenta.saldo > 0 %}text-danger{% elif cuenta.saldo < 0 %}text-success{% endif %}">${{ cuenta.saldo }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="4">No hay cuentas corrientes.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
